{% extends "base.html" %}

{% block title %}–î–∞—à–±–æ—Ä–¥ - Instagram Auto Post Tool V3{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">–î–∞—à–±–æ—Ä–¥</h1>
    <p class="page-subtitle">–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</p>
</div>

<div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
    <div class="stat-card card">
        <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">–í—Å–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤</div>
        <div style="font-size: 32px; font-weight: 700;" id="totalAccounts">0</div>
    </div>
    
    <div class="stat-card card">
        <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">–ê–∫—Ç–∏–≤–Ω—ã–µ</div>
        <div style="font-size: 32px; font-weight: 700; color: var(--success);" id="activeAccounts">0</div>
    </div>
    
    <div class="stat-card card">
        <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –ø–æ—Å—Ç–æ–≤</div>
        <div style="font-size: 32px; font-weight: 700; color: var(--accent);" id="scheduledPosts">0</div>
    </div>
    
    <div class="stat-card card">
        <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</div>
        <div style="font-size: 32px; font-weight: 700; color: var(--success);" id="publishedPosts">0</div>
    </div>
</div>

<div class="card">
    <h2 class="card-title">–°—Ç–∞—Ç—É—Å –∞–∫–∫–∞—É–Ω—Ç–æ–≤</h2>
    <div id="accountsList"></div>
</div>

<div class="card">
    <h2 class="card-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
    <div id="recentLogs" style="font-family: monospace; font-size: 13px; max-height: 300px; overflow-y: auto;"></div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    async function loadDashboard() {
        try {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–∫–∫–∞—É–Ω—Ç—ã
            const accountsData = await apiRequest('/api/accounts');
            const accounts = accountsData.accounts;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            document.getElementById('totalAccounts').textContent = accounts.length;
            document.getElementById('activeAccounts').textContent = 
                accounts.filter(a => a.status === 'active').length;
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
            const accountsList = document.getElementById('accountsList');
            if (accounts.length === 0) {
                accountsList.innerHTML = '<p style="color: var(--text-secondary);">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–æ–≤. <a href="/accounts">–î–æ–±–∞–≤–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</a></p>';
            } else {
                accountsList.innerHTML = accounts.map(acc => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid var(--border);">
                        <div>
                            <div style="font-weight: 600;">${acc.username}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">–¢–µ–º–∞: ${acc.theme || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</div>
                        </div>
                        <span class="status-badge status-${acc.status}">
                            ${acc.status === 'active' ? '‚úÖ –ê–∫—Ç–∏–≤–µ–Ω' : 
                              acc.status === 'error' ? '‚ùå –û—à–∏–±–∫–∞' :
                              acc.status === 'logging_in' ? 'üîÑ –í—Ö–æ–¥...' : '‚è∏Ô∏è –ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}
                        </span>
                    </div>
                `).join('');
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å—Ç—ã
            const postsData = await apiRequest('/api/posts');
            const posts = postsData.posts;
            
            document.getElementById('scheduledPosts').textContent = 
                posts.filter(p => p.status === 'scheduled').length;
            document.getElementById('publishedPosts').textContent = 
                posts.filter(p => p.status === 'published').length;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–æ–≥–∏
            const logsData = await apiRequest('/api/logs?limit=20');
            const recentLogs = document.getElementById('recentLogs');
            recentLogs.innerHTML = logsData.logs.join('');
            
        } catch (error) {
            showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ' + error.message, 'error');
        }
    }
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadDashboard();
    
    // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    setInterval(loadDashboard, 30000);
</script>
{% endblock %}
